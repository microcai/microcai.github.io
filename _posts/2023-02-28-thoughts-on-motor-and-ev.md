---
layout: post
title: 电机和电车的一点想法
tags:   [电机]
---

除了有刷电机外, 无电刷的电机, 驱动起来是一门学问.

# 反电动势

在讲解这门学问前, 先回顾一下物理学上的一个公理, 能量守恒定律. 能量守恒定律在电机控制领域非常重要, 电机的很多特性, 都来自宇宙要遵守能量守恒定律导致的.

反电动势是电机达成能量守恒定律的一个重要手段.

    电机的输入电流 = (电池电压\*占空比 - 电机反电动势) / 绕组阻抗
    绕组电流 = 电池电压\*输入电流 / 反电动势

这里面的原因是, 电机的输入电流, 也就是从电池汲取的电流, 功率 = 电池电压\*电机输入电流.

但是, 电机的扭矩来自于绕组的电流(达到磁通饱和前, 电机扭矩正比于绕组电流), 而和电机的转速无关. 因此绕组电流和输入电流不是一回事.
如果绕组电流等同于电池供应给电机的电流, 那么电机就违背了能量守恒定律.

因为电机的功率 = 扭矩\*转速, 而反电动势正比于转速, 扭矩正比于绕组电流. 所以电机的功率 = 绕组电流\*反电动势

这里, 就要得出一个 绕组电流\*反电动势 = 电池电压*电机输入电流 的能量守恒来.

如果电机没有反电动势, 能量守恒就要被破坏.

正是因为绕组电流和电池供应的电流不同, 所以电机控制器, 不仅仅承担为电机"电子换相" 的工作, 也承担 DC/DC 变压的工作. 准确的来说, 是 Buck Converter.

![降压变换器电路图](https://upload.wikimedia.org/wikipedia/commons/thumb/3/33/Buck_circuit_diagram.svg/600px-Buck_circuit_diagram.svg.png)

绕组电流需要"续流二极管" 的存在, 这个存在, 是由开关管上的寄生二极管承担的.

因此, 在电机控制器里, 承受功率的开关管, 其工作电流实际上是和电机扭矩有关, 而和电机输出功率无关. 正是为了保护控制器里的开关管, 同时也避免电机内部磁通饱和, 所以电机的扭矩调教为 初段恒扭矩, 后段恒功率.

如果一直要输出最大功率, 想想在低速下, 扭矩 = 功率/转速. 转速为 0 或者接近 0 的情况下, 扭矩要无限大. 这在工程上是无法实现的. 所以电机在低速下只能恒扭矩, 随着转速的提升而提升功率. 到了后期, 电机就进入恒功率模式, 扭矩随着转速的提高而下降.

而电机进入恒功率模式, 恰恰又是因为反电动势的存在, 限制了电机的电流.

因为, 实际上加在绕组两端的电压, 等于 输入电压/反电动势. 当反电动势接近电池电压后,
绕组两端的电压 / 绕组阻抗 后, 就无法维持更大电流了. 因为随着转速的提高, 电机的换相速度也提高了, 也就是提高了交流电的频率. 那么电机的绕组作为一个感性元件, 其交流感抗也在提高. 电压降低, 阻抗提高, 电流就不得不继续降低了.

电机从恒扭矩到恒功率转折点就是一个非常关键的指标.

反电动势是限制电机最高转速的最关键原因. 电池电压必须高过反电动势, 才能让电机继续提速.

降低反电动势, 就是要减少绕组, 但是会降低电机扭矩.
所以高扭和高转在电机上就是个矛盾体.

# 方波 vs 正弦波

无刷电机, 通常会分为直流无刷电机, 或者是永磁同步电机. 他们的结构都是一样的 : 绕组定子+永磁体转子.

区别就在于, 直流无刷电机, 使用的是6步换向法驱动. 每时每刻只有2条线是通电的. 另一条线悬空. 而永磁无刷电机, 使用的是矢量控制驱动, 让三相电构成的磁场矢量, 始终与定子的磁场矢量垂直以获得最大扭矩.

一个电机, 使用6步换向法驱动, 还是使用矢量控制驱动, 关键在于其反电动势的波形.
如果反电动势的波形为三相交流电, 则应该使用矢量控制驱动. 如果反电动势的波形为梯形波, 则使用6步换向法驱动.

6步换向法驱动, 电机每旋转一周, 就要执行6次换向. 每次换向, 不可避免的会带来冲击.
而使用矢量控制驱动, 电机可以输出恒定扭矩, 不会有换向冲击.

但是为了合成正弦波, 控制器必须使用频率更高的开关速度才能调制出完美的正弦波. 开关频率越高, 波形越完美. 波形越完美, 则输出越稳定, 电机效率也越高.

同时, 为了定子的合成磁场始终垂直于转子, 需要更高精度的转子位置传感器. 所以矢量控制驱动法的控制器成本会高于6步换向驱动.

方波相比正弦波, 有个优势就是能 100% 利用电池电压. 而使用正弦波, 电池电压只能用于提供交流电波形里的峰值电压, 而交流电的有效电压只能是电池电压的 1/ √(3) .

为了克服矢量驱动不能有效利用电池电压的缺点, 有发明一种叫 "马鞍波" 的过调制方法.

![马鞍波](/images/svpwm-maan.jpg)

这种调制方式可以提高母线电压的利用率.

# 动能回收

永磁电机可以当作发电机使用, 将汽车的动能回收回电池.

但是具体的回收方式, 又分为 负扭矩法, 和整流升压法.

整流升压法最简单, 就是把电机当成发电机, 发电机输出的三相交流电, 桥式整流后升压, 就可以给电池充电了. 但是这个方法其实在工程上并不使用.

工程上使用的另一个能量回收的方法, 其实非常的简单, 就是小 pwm 法.
就是使用更小的 pwm , 使得 电池电压*pwm < 当前转速的反电动势.

只要当前的 pwm 设定会导致控制器输出电压小于电机反电动势电压, 则控制器的逆变桥会反过来, 工作在 Boost 升压状态, 将电动机的电流反馈到输入端.

因为 6 个开关管构成的逆变桥, 会本能的工作于四象限状态. 只要开关管对应的状态, 和电机转子位置一致即可. 因为电机在工作的时候, 功率因素是不可能为 1 的. 所以电流滞后于电压, 导致电机总是会在每个周期里向输入端回馈部分能量. 所以6个mos构成的逆变桥是天然的工作在4象限的.

实际上, 三相PFC电路, 就可以看成是对一个恒定转速的电机进行动能回收.

这种模式的动能回收, 有个缺点, 就是如果转速下降后, 不及时停止, 就会从回收模式进入驱动模式. 而整流升压法就不会有最低回收速度限制.

