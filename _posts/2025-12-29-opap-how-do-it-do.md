---
layout: post
title: 运算放大器运算了什么
tags: [运算放大器, 闭环控制]
---

# 什么是运放

模拟电路的基础元件，有 二极管，三极管，电容，电阻，电感，还有.......运放。

运放，虽然这个基础结构实际上内部是由多个三极管构成的，但是，他依然是基础元件。

而且这个基础元件，就好像电容电感一样，有一个“理论最优”的模型，但是实际上做不出来。

这个理论模型，就是放大倍数无穷大。

如果，只是放大倍数无穷大，运放是无法成为基础元件的。

运放能成为基础元件，最关键的原因，是运放是一个图灵部件。

运放在电路中最关键的作用，是执行“死循环”，使得模拟电路图灵完备。

# 死循环

模拟电路也是计算机。模拟计算也是计算。

运放在模拟电路里最重要的功能，就是实现死循环，完成“闭环控制”。

例如在一个开关电源里，运放在其中扮演的，就是精细调控占空比的角色。

通过分压电阻采集目标电压（反馈输入），然后和基准电压（控制目标）进行比较，产生新的占空比电压（控制输出），最后由三角波比较器输出为占空比调制信号。

这样一个 反馈输入-》比较控制目标-》输出控制信号 要变成一个死循环，快速的不断循环。
这个循环，就是由运放执行的。

而且运放执行这个控制循环的速度，是数字电路望尘莫及的。运放执行这个控制循环的速度，就是运放的带宽。

控制速度，不能高于开关速度。而运放的带宽远高于电力电子器件的开关速度。因此绝大多数情况下，我们要降低控制带宽。

降低带宽的办法，不是让运放慢一点，而是修改反馈给运放的信号，让反馈信号慢下来。

但是，运放的带宽实际上并没有下降。如果输入的信号有“延迟”。运放动作太快了，就会振荡。

比如反馈电压低了，运放增大占空比，但是占空比增大后，反馈的电压不能立即反应，需要滞后一段时间。
此时运放就会因为反馈的电压一直很低，而不断增大 占空比。直到最初增大占空比的效果呈现，然后反馈回来的电压就会一下冲过头。此时运放就会反过来立即减小占空比。然后延迟达成效果后，再来个电压过低。

然后运放又增大占空比。

这样来回拉锯，始终不能稳定。这个就是反馈信号有延迟导致的运放振荡。

# 运放的偿

这个时候，就要进行一次前馈补偿。
所谓的前馈补偿，就是提前把运放 “增大占空比” 的效果给反馈给运放。免得运放认为反馈回来的信号一直不够而继续增大占空比，然后过冲。。。。

在真实的占空比增大带来的反馈电压抬高之前，就提前把“反馈电压”给抬高。使得运放“以为”反馈电压已经正常了，就停止调节。

这个就是运放必须要做前馈调节，而数字控制不需要的原因。因为数字控制可以直接修改算法实现。
但是运放的反馈调节算法是死的，是通过在 “反馈” 这个地方进行劫持来达成所谓的修改控制算法的目的。

运放的补偿，实际上就是个预测器。

提前把运放的输出结果进行预测，然后将预测值叠加在真实的反馈值之上，再送给运放。
这样运放就“认为”条件已经满足，从而停止调节。实现了运放的稳定运行，避免反复调节导致的震荡。

运放的补偿通常由电容和电阻串联构成。

电容的大小，决定了预测多久，电阻的大小，决定预测的结果叠多少回真实值。

