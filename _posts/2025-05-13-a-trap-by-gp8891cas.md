---
layout: post
title: 记录使用 GP8891CAS 时踩的一个天坑
tags: [PCB, FlyBack, ACDC, GP8891CAS]
---

# 序

任何一个家电，必须得有一个低压供电电源。

要获得一个低压供电，通常的做法是接一个开关电源。

但是，外置的电源徒增成本。而且显得很不专业。最好的办法就是在 PCB 上集成一个供电电源。

想起来前年我刚刚入门硬件设计。做了一个 低压变频器。
到去年年初的时候，开始尝试制作 220V 市电版的变频器。事情见 [这片文章](/2024/02/05/220v-vfd-success.html)。

那时候，我是不懂 ACDC 变换的。因此电路板上低压供电，是由电源模块实现的。

比如当时的照片

![](/images/photo_2024-02-08_13-22-33.jpg)

可以看到 画面中有2个 电源模块的位置。

没错，还得用俩电源模块。分别供应高压侧的栅极驱动，和低压侧的单片机。

而且还分别是 220V转 12V 和 220V 转5V 。虽然两个模块并不贵。三块多一个。但是，加起来也有七块钱了。

而且还让我的设计不紧凑，使用了外挂电源模块。显得很不高级。

后来，我改进了设计。因为我绘制低压的时候，经常就使用 32V转5V的 DCDC 电路。

因此，我使用了 DK501 这款能直接从 DC310V 经过 Buck变换降压到 12V 的芯片。

还是熟悉的 Buck 电路。

但是， Buck 降压是非隔离的。为了给单片机供一个隔离的电，我还是使用了一个 12V转5V的隔离电源模块。

这样让板子的外挂电源从2个变成了1个。。。。

# FlyBuck 方案

我发现，要设计好电路，一定要先学会电源。没有电源任何事情都办不成。
于是我开始在看 B站上长江大学的唐老师的视频。唐老师是长江大学的老师，专门教电源电路的。他出了几百期视频，大部分就是在讲解 Buck/Boost/SEPIC 这类 DCDC 电路。

看了几百期视频，我才了解到，有一种廉价的隔离电源的方案，叫 FlyBuck 。 就是把 buck 电路的电感换成2个绕组的共模电感。

这样在共模电感的另一个线圈，就能直接获得一个同样电压的隔离供电。

于是，这就是我后来改进的方案了。后来这个方案被用在了 ACBuck 电路里。

ACBuck 使用 DK501 从 整流后的 310V 直流电直接 BUCK 降压到 12V, 但是，使用的 flybuck, 偷偷的把电感换成了共模电感。于是在主回路获得非隔离的 12V, 在另一个绕组获得隔离的 12V。
然后 12V 经过降压获得 3.3v 给单片机使用。


# 进入反激的世界

正当我觉得 高压 Buck直降 + FlyBuck 能同时获得一个隔离电源的方案满足了我的需求后。我固步自封了。因为其他的方案难度都太大了。既然简单的方案能满足，我就懒得学习复杂的电源拓扑了。

直到数月前。一个华强北人士找到了我。说要我帮他设计一个变频器。

我以为他是看到我的 10元变频器 方案动心了呢。结果他要我做一个 三相380V输入，三相380V输出的变频器。

不过都答应给他做一个了，于是我花了几天功夫给他设计了一份。核心电路（单片机+逆变桥）几个小时就绘制完毕了。

但是，供电部分我犯愁了。

因为我熟悉的 高压 buck 直降，并不能用在 380V 输入的场合。

类似 DK501 这样的 高压输入 Buck 降压芯片，也不过是耐压到 400V 直流电。
而 380V 交流，整流后的电压是 540V, 还得考虑电源的电压波动，需要留有余量，最低也得支持到 700V 输入的  buck 芯片。

然而，市面上并不存在如此高压的 buck 降压芯片。

因此，我只能使用反激电源。


好在，几百期唐老师的视频不是白看的。我马上到德州仪器的网站找设计案例。唐老师特别推崇德州仪器的网站，说这个网站是大宝库。

果不其然，我抄到了反激电源的设计。

于是，我抄了一份 德州仪器的设计，然后给华强北老板交差了。

这也是我第一次使用反激电源，结果很奇迹的，一次成功。只有个别需要飞线修正的，更新到原理图后，就可以直接量产了。不需要来回修正打样。。。。

老板手下员工惊呼，居然只需打样一次！

呵呵，没办法，我以前设计的时候是各种花冤枉钱，打样一堆失败品才能最终获得一个能用的。
最后痛定思痛，改掉了程序员的陋习。尽量让设计可以一次打样，下次就可量产。

    为什么说是程序员的陋习呢？因为程序员打样一个新版本，只要 Ctrl+S, 然后按 F7 编译。
    失败了也不要紧，改了可以马上重新编译。于是程序员养成了随时编译（换到硬件领域就是随时随地打样一个错误的不能工作的电路）的陋习。


这次使用反激电源的经历，使得我对“开关电源”的理解更透彻了。

反思了以前的设计，突然发现，其实 FlyBuck 并不比反激便宜。

# 史上最低价的 ACDC 芯片

为啥呢？因为反激的控制器芯片非常的便宜。
得益于开关电源的大量使用。反激控制器芯片大概也许是这个星球上，产量最大，型号最多，价钱最低的芯片类型了。

DCDC 降压和升压芯片，分别只能降压或者升压，还都比反激芯片贵。而反激即能降压，也能升压。

Buck 降压只是从原理上来说简单，但是实际产品因为竞争没那么充分，没那么卷。所以 buck 芯片的价格还不够低。

反激芯片，则卷出天际了。于是内部逻辑更复杂，需要更多晶体管实现的反激芯片，卖到了比 buck 更低的地步。

GP8891CAS 就是这个卷出天际的市场里被我发现的一个胜利者。

哪怕是以高价著称的立创商场，他的售价也不足2毛钱。

于是，我将原先为宁波老板设计的一个廉价变频器，改进为使用反激电源供电。
原始的设计，是使用非隔离供电来降低成本。单片机直接使用 DK501 降压出来的5V非隔离电源。

而使用了反激电源的设计，在只略微增加一元钱成本的情况下，就用上了隔离的设计。其实增加的一元成本，主要是因为需要使用一个2元的隔离器。没错，电源本身，还降低了1元的成本！

是的，使用了最低价的 ACDC 反激芯片后，反激变换器隔离供电的成本，低于高压Buck降压的非隔离方案。

为啥呢？因为高压 Buck 降压，使用的 DK501 芯片要6毛钱。芯片贵4毛。同时，高压 Buck 降压方案，需要使用 2mH/1A 的电感。这样的电感就要一元多了。

而反激方案，芯片只要1毛6，同时，EE10 变压器也只要5毛钱。


# 踩坑

我满心欢喜的完成了设计，然后打样。结果上电就炸芯片。炸的就是 GP8891CAS 。

    还好我测试的时候，那个板子只焊接了供电部分的元件。不会顺带报销掉单片机 集成功率模块 等其他高价值元件。

如果我从淘宝买的 GP8891CAS，我大概 会怀疑自己买到假芯片了 (这其实也是淘宝假芯片多的谣言由来)。

但是因为 GP8891CAS 恰恰淘宝上无货，我从立创商城买的。所以肯定是自己用错了，而不是假货的缘故。

但是，仔细翻阅手册，发现就是照着手册的 “典型应用电路” 做的。

到底哪出问题了呢？


## 寻找 GP8891CAS 的抄袭对象

所以，问题就在于，抄袭芯片的手册通常是不能看的。
得看 原版被抄袭对象的手册。

结果不搜不知，好家伙， GP8891CAS 已经不知道是几手抄袭了。
原来 GP8891CAS 是替代品的替代品的替代品。难怪价格卷出天际了。

于是找到了他的替代对象，MT2513B。研读了它的手册。其实 MT2513B 的直接替代品是 3667B 。GP8891CAS 应该是替代3667B 的。

然而 MT2513B 本身也是另一个芯片的替代品。。。。

最后在各种 “相似芯片” 的海洋里，扒到了真正的源头，CR52177SC。

为啥能确认这个是真正的源头呢？ 因为芯片原厂给了 “设计案例”。。而不单单是一个数据手册。

正如 UC3842 在 德州仪器的官网能找到 设计案例 一样。

然而，这个 CR52177SC 的设计案例，却不免费提供。免费提供的，只有这个设计案例的 “照片展示”。
原理图得联系经理，不能官网直接看。

照片如下：

![](http://9982006.s21i.faiusr.com/4/ABUIABAEGAAg6O7HlwYooKupuQQw3AU40wE.png.webp)


这就不大方了，不如 德州仪器啊。你不给，1毛6的替代品照样造出来抢你市场。


不过，综合了好几款同功能的相互替代的芯片的数据手册后，我终于找到了炸芯片的根源。

然后飞线修正之。

最后跑起来了。

演示视频看 [这里](https://www.bilibili.com/video/BV1gkE5zdEs4)


成品效果图：

![](/images/25yuan_vvvf.jpg)

## 总结

使用 反激控制器后，只要增加一个绕组，就能多获得一个隔离电源。因此，如果需要多路不同的电压供电，反激就特别适合。以几乎免费的方式获得隔离电源。

相比去年我用2个独立的 220v转5v 的电源模块，板子上直接集成一个反激电源的方案，不仅仅大幅缩小了体积，也大幅降低了成本。

经此次成功的反激电源设计经历，以后我可以是认为自己总算入门了硬件电路设计。

然后，要多相信芯片的 原理框图，然后根据这个理解来设计外围电路，而不是抄 “典型应用电路图”。
