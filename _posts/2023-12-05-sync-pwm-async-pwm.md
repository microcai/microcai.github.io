---
layout: post
title: 制作变频器-第五部分
tags: [变频器, 同步调制, 异步调制]
---

# pwm 调制 正弦波

计算机的世界是一个离散的世界。离散的世界，是用很小的矩形去逼近连续的世界。

其实傅里叶告诉我们，一切波形都是正弦波的叠加。

于是 pwm 看起来是方波，但是其实也是正弦波。

pwm 之所以可以模拟正弦波的效果，就是因为 pwm 可以看成被模拟的正弦波+很多很多的谐波构成。

而这些多余的谐波，只要这个谐波的频率比正弦波本体大很多，就可以被低通滤波器完美的过滤掉。

# pwm 频率和 开关损耗

pwm 的频率越高，则调制比就越大。所谓调制比，就是pwm的频率和逆变器要输出的正弦波频率的比值。

理论上来说， pwm 的频率越高，调制比越大，那么经过电机绕组这个大电感后过滤出来的电流，就会越接近完美的正弦波。
也就是电流的谐波就越少。
因为电感对高频的阻碍作用是越来越大的。电机绕组里的电流越接近正弦波，则谐波损失越少。 
因为只有基频才能输出机械能。高频的谐波只能变成震动和发热。

所以，从降低电机的铁损来说，pwm 的频率越高越好。

但是， pwm 频率太高了，也有一个缺点，就是导致开关损耗增加。
因为 MOS 管不是理想的开关管。即使是理想的开关管，也不能突破物理定律让电流突变。

MOS管关闭和打开的时候，电流从 最大到0，和从0到最大，中间必然是有一个斜坡的。这个斜坡，意味着加在MOS管两端的电压是持续变化的。于是电压和电流的乘积，会先增加后减少。他们的积分，就是 MOS 管的开关损耗。

MOS管的开关速度越快，积分就会越少。也就是开关损耗越低。

这就是为啥要使用氮化镓的由来。

传统上，使用硅参锗做的晶体管，每一层硅原子的耐压不高。导致 MOS 管要想更高的耐压，其参杂厚度就要增加。
而增加的参杂厚度，必然会降低开关速度。

也就是 MOS 管的 耐压和开关速度，是个矛盾体。

耐压 1.5v 的，比如用来构成 CPU 里的门电路的管子，开关速度可以做到数个 GHZ。
但是，耐压到 1500v 的管子，开关速度就只能做到 1khz 了。

如果把制作材料从硅改为氮化镓，则同样 1500v 耐压，开关速度还可以做到 1Mhz。

而变频器，始终是需要面对大电压大电流的工况的。而新材料MOS管非常的贵。所以变频器，是不能异想天开的使用一个超高的 pwm 频率。
而是始终要面临开关损耗问题。

在开关损耗和电机的谐波铁损之间取折衷，于是变频器普遍会使用 1khz - 8khz 的开关频率。而且越是大功率的变频器，开关频率都倾向于比小功率的更低。

# 异步调制和同步调制

异步调制，就是 pwm 的频率和输出的正弦波的频率之间没有关系。二者是异步的。通常在变频器的整个工作期间都会使用某个固定的 pwm 频率。

异步调制有一个重要的特点就是输出的脉冲波是不对成的，不仅1/4脉冲不对成，正负半周期的脉冲也不对称，这会导致电流输出的谐波较多。

同步调制的载波比N等于常数，并在变频时使载波和调制波保持同步的方式称为同步调制。且 N 为能被3整除的奇数。
所谓载波比，就是指pwm的频率和输出的正弦波的频率之比。 当载波比为常数时，每个正弦波周期，输出固定个数的 pwm 波。
正弦波的频率提高，pwm的频率也随之提高。
这种调制模式下，谐波含量相比pwm频率相当的异步调制会更少。

如果载波比是完全固定，则pwm频率会随着输出频率的上升而上升到超过最大 pwm 频率限制。
此时变频器的做法就是换一个小点的载波比。反之频率减小的情况下也会切换更大的载波比。

这种载波比切换，就会形成一种音阶。

# 同步调制和异步调制在代码实现上的异同

不管是同步调制还是异步调制。最终都是在 pwm 硬件定时器的中断里更新下一个周期的 pwm 占空比。

因此下一个 pwm 周期的占空比计算方式就是

$sin( 当前相位 + （1/pwm周期*正弦波频率）)$

不管是同步调制还是异步调制，唯一的区别就是 这里的 pwm周期，它是个 constexpr int 变量还是 int 变量.

同步调制增加了改变pwm频率的代码。在计算下一个周期的占空比时，还要跟新下一个周期的pwm频率。

