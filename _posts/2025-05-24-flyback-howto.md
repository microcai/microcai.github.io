---
layout: post
title: 了解反激，驯服反激
tags: [PCB, FlyBack, ACDC]
---

# 序

反激，这恐怕是当今世上使用最广泛的开关电源拓扑了。

学习电力电子技术，就从反激开始。

# 何谓反激

反激反激，顾名思义，是反过来激发。啥叫反过来呢？意思就是，开关管关闭的时候，变压器才开始干活。开关管关闭了，变压器主绕组上都没电流了，变压器才开始干活。
这没电流了才想起来该干活了，所以是反着的。故得名反激。有反必有正，故而必有一个正激来对应。

## 为何要反过来干活

其实开关电源最先诞生的拓扑绝对不是反激。可能是正激，也可能是推挽。

正激变压器其实更容易理解，因为他就是按照变压器的定义工作的。正激变换器拓扑可以看成是隔离版的 Buck 降压电路。

所以，反激也可以看成是隔离版的Boost升压电路。

因为，反激和 Boost 升压的一个共同点是，都是在开关管关断的时候，才能对外输出能量。

因此，反激之所以要反过来干活，其实他脱胎自 boost 升压电路。

在 Boost 变换器里，开关管打开的时候，输出二极管截止。输入电压全部施加在电感上，对电感进行充能。随着时间推移，电感上的电流越来越大。
如果电流大到突破电感的饱和值，电感就会突然失去电感特性，变成一条导线，于是短路炸机。好在，控制器不会允许电感电流突破饱和值，而是适时的关闭 开关管。
因为电感电流不能突变，因此电感的电流需要寻找突破口继续流动。于是就会击穿 输出二极管，对输出电容进行充电。直到开关管下一次打开。下一次打开前，电感电流要么已经归0,要么还有剩余电流。

而在 反激变换器里，其实这个过程由变压器的两个绕组分别在不同的时间不同的空间完成。
开关管打开的时候，次级的二极管截止，次级线圈没有电流。输入电压全部施加在初级线圈上，对变压器进行充能。随着时间推移，初级线圈上的电流越来越大。
如果电流大到突破变压器磁芯的饱和值，变压器就会突然失去感抗，变成一条导线，于是短路炸机。好在，控制器不会允许初级线圈电流突破饱和值，而是适时的关闭 开关管。

但是此时，电感电流不能突变的定律就不再适用了。其实电感电流不能突变不是铁律，真正的铁律是磁通量不能突变。为了维持磁通量不变，电感的电流才不能突变。
如果铁芯上绕有2个绕组，那么另一个绕组立即产生电流，也可以维持磁通量不变。

而次级绕组上的二极管，恰恰会在初级的开关管关闭的时候，允许电流通过了。于是，为了维持磁通量不变，次级立即会产生 N倍于初级关管时刻电流的电流。这个 N 取决于变压器线圈的匝比。
这就是所谓的 安匝平衡。

所以，反激和 Boost 升压的一个改进之处，是它输出有了一个N倍的电流放大，这导致了输出有了 N 倍的电压下降。于是反激相比 boost 升压电路，反而可以因为这个变比实现降压。
然后是输出又另一个线圈完成，于是输入输出就电气隔离了。


## 相比正激的优势

任何变压电路，都需要电感的参与。正激是隔离版的 Buck 。但是，他的变压器不是电感。他的变压器只是实现了电流的比例变换。变换后，还需要电感“续流”才能实现完整的回路。

也就是说，在正激变换器里，变压器+开关管，只是实现了非隔离 Buck 电路里的 “开关管” 的功能。另一个电感，还需要存在以维持开关管关闭的时候的输出。

所以，在正激变换器里，需要一个变压器变压，同时输出还需要有一个电感。

而反激变换器里，变压器同时承担电流放大和电感的功能。因此，反激变换器相比正激最大的意义，就是省去了一个输出侧的电感。

从而极大的降低了成本。

## 反激的劣势

反激的优势是便宜，而劣势则是漏感带来的能量损耗。理想的变压器当然没有漏感。然而现实中的变压器有。
意味着初级的开关管关断的时候，并不能100%的将能量转移到次级。

这部分不能转移到次级的能量，继续推动初级线圈的电流运动。然而此时开关管已经关断，于是电感的电流没有续流路径，反而会形成一个尖峰电压加在开关管上。
为了吸收这部分能量保护开关管，就需要一个由电容电阻构成的吸收电路，通过发热消耗掉漏感能量。

因此，反激的第一个劣势，就是变压器漏感一定会产生能量损耗。这部分损耗和初级线圈电流的平方成正比，和初级的漏感成正比。

电流越大，漏感导致的能量损失就越大。

因此反激一定要限制初级的峰值电流。也就限制了整个电源的功率不能太大。

# 元件参数的计算

在反激变换器里，最关键和最难的是变压器参数的计算。

反激的变压器，不单单是变压器，他还是电感。因此，反激的变压器，不能只看匝数。还得看电感。

因此，反激变换器里，变压器的几个关键参数需要设计阶段进行抉择：

1. 变压器磁芯
2. 初级匝数
3. 次级匝数
4. 气隙

诶？气隙是怎么回事？为啥要磨呢？

## 匝数计算

不是只要保证匝比一样，就可以随意决定初级的匝数的。匝数的多寡，主要是为了最大化的利用磁芯的饱和磁通。匝数多了，那么只要较小的电流即可产生巨大的磁通量，容易饱和。
匝数少了，则磁通量的变化量就不够大，不能有效利用磁芯。

因此，需要利用设计初期的时候就定下来的**目标**来决定匝数。磁芯确定后，匝数就直接和峰值电流绑定了。磁通量变化量和峰值电流除就得到了所需的初级匝数。

## 气隙

那么，为啥要磨呢？因为反激变压器，他不单单是变压器。变压器只要确定匝数，而反激还是个电感。因此，它还需要确定电感量！

如果你按计算的匝数绕变压器，会发现一个结果：测量后发现初级的电感量非常大。

为啥反激需要给定的初级电感量呢？

因为反激是 ”储能-释放“ 这样的结构。以 60W 的反激电源为例子。假设开关频率为 60khz,意味着每次开关管打开的时候，变压器磁芯里都要存储60/60000 = 1mW 的能量。

而我们知道，反激变压器乃 boost 变换器升级而来。他的初次级要满足安匝守恒。根据 安匝守恒 可以很快计算出来，开关管关闭的瞬间，初级线圈所必须具有的电流。
没错，这个电流是个确定值，不可更改。 _正是如此，大名鼎鼎的3842 才是个电流模式 pwm 控制器。其控制的，就是关管时刻的初级绕组电流。_
然后，因为反激的变压器是个电感，要存储能量。而电感存储的能力，正好正比于电流的平方和电感的乘积。

如此一来，就直接确定了初级线圈所必须的电感值。

也就是说，初级线圈的 匝数和电感值，都是根据设计目标直接确定的。

然而，直接在磁芯上绕这么多匝数，测量后几乎100% 会发现，实际制作出来的变压器，初级电感值会大于设计值。

那么，如何让电感值能和设计值一样呢？ 调整匝比？ 不能。因为匝数也是计算获得的。
调整磁芯？ 不能，因为匝数的计算就是依据选定的磁芯。

那还能怎么办？

答案就剩下了唯一一个：开气隙。


变压器的铁芯如果不紧密贴合，就会有漏磁。有漏磁就会产生漏感。那么开气隙是否和这个要求背道而驰呢？

其实并不。因为只有边缘的磁芯不贴合才会有漏磁。中柱有间隙，那么磁场会从中间的空气穿过，而不会泄漏到线圈的外部。

因此，反激变压器，100% 需要磨气隙，缩小电感值到设计的电感值。

所谓磨气隙，是针对自制变压器来说的。因为设计阶段自制变压器的时候，磁芯是标准规格的货架产品。量产的时候，是直接计算获得中柱的间隙。直接生产出中柱有间隙的磁芯即可。

# 尖峰吸收

其实任何感性负载，都要考虑 MOS 管关闭后，因电感电流不能突变而来的续流问题。

这个电流有3种办法解决， 其一是强行遏制，就需要使用阻容元件进行吸收了。其二是将其回收回母线电容。其三是让他来回震荡，利用它产生谐振。

反激变换器通常使用的是第一种办法。使用阻容元件吸收，就得计算需要使用多大的电容和电阻来吸收。这就需要知道变压器的漏感和峰值电流，还有  MOS 的耐压。

计算方式如下：

> 漏感记为 L, mos管关闭的时候，绕组的电流记 I . 那么无法传递给次级的能量，就是 I\*I\*L/2。
> 这个能量由电容先行吸收，吸收后，电容电压抬升, 抬升幅度为 U .抬升所吸收的能量，为漏感能量。
> 也就是 U\*U\*C/2 = I\*I\*L/2 。那么这个 抬升幅度 U ，要小于 mos 的耐压 - 电源电压。
> 通常取 200V。这样就算出来需要多大的 C 来吸收了。
>
> 每次开关，都会产生泄漏，这个泄漏功率，就和开关频率有关，开关频率记为 fs, 那么泄漏功率就是 I\*I\*L/2\* fs。
> 这个功率要靠电容给消耗。电容的热功率 = U\*U\/R。令 U = 200V, 就得出了 吸收电阻的大小。

